# Supabase Database Setup Guide

## 📋 Quick Setup (5 minutes)

### Step 1: Access Supabase SQL Editor

1. Go to your Supabase project: https://supabase.com/dashboard
2. Select your project: **Proofound MVP**
3. Click on **SQL Editor** in the left sidebar

### Step 2: Run the Migration Script

1. Click **New Query** in the SQL Editor
2. Open the file: `supabase/migrations/00_initial_schema.sql`
3. **Copy the entire contents** of the file
4. **Paste** into the SQL Editor
5. Click **Run** (or press Cmd/Ctrl + Enter)

⏱️ **This will take about 10-20 seconds to complete.**

### Step 3: Verify Installation

After running the script, verify these tables exist:

#### Core Tables (11 total):
- ✅ `profiles` - User accounts (individuals & organizations)
- ✅ `organizations` - Organization details
- ✅ `assignments` - Job/project postings
- ✅ `matches` - AI-powered matching results
- ✅ `messages` - Real-time messaging
- ✅ `expertise_atlas` - Skills management
- ✅ `proofs` - Credibility proofs
- ✅ `verification_requests` - Referee verification workflow
- ✅ `artifacts` - Supporting documents
- ✅ `analytics_events` - Privacy-first analytics
- ✅ `reports` - Moderation system

To verify, go to **Table Editor** in Supabase dashboard and check all tables are listed.

---

## 🔐 Security Features Included

### Row Level Security (RLS)
All tables have RLS enabled with policies:

- **Profiles**: Users can only edit their own profile
- **Messages**: Users can only see their own conversations
- **Matches**: Users see only their matches
- **Admin**: Admins have elevated permissions for moderation

### Data Privacy
- Field-level visibility controls (`field_visibility` in profiles)
- Soft deletes (data marked deleted but not removed)
- GDPR-compliant analytics (opt-out support)

---

## 📊 What's Included

### 1. **Database Schema**
- 11 tables with proper relationships
- Foreign keys and constraints
- Default values and check constraints

### 2. **Performance Indexes**
- 20+ indexes for fast queries
- Optimized for:
  - Profile lookups
  - Match generation
  - Message retrieval
  - Analytics queries

### 3. **Triggers**
- Auto-update `updated_at` timestamps
- Maintains data consistency

### 4. **RLS Policies**
- Secure access control
- Multi-persona support (individual/organization/admin)

---

## 🚀 Next Steps After Setup

### 1. Test Database Connection
Visit your app at http://localhost:3000 and:
- Sign up with a test account
- Check if profile gets created in Supabase

### 2. Create Admin Account (Optional)
If you want admin access:

```sql
UPDATE profiles
SET is_admin = true
WHERE email = 'your-email@example.com';
```

### 3. Enable Realtime (for messaging)
In Supabase dashboard:
1. Go to **Database** > **Replication**
2. Enable replication for: `messages` table
3. Save changes

---

## 🔧 Troubleshooting

### Error: "relation already exists"
**Solution**: Some tables already exist. You can either:
1. Drop existing tables first (⚠️ **WARNING: This deletes all data**)
2. Run individual `CREATE TABLE IF NOT EXISTS` statements

### Error: "insufficient privileges"
**Solution**: Make sure you're using the Supabase SQL Editor (has admin privileges)

### Migration doesn't run completely
**Solution**: The script is safe to run multiple times due to `IF NOT EXISTS` checks

---

## 📝 Schema Documentation

### Key Tables Explained

#### **profiles**
- Unified table for individuals AND organizations
- `account_type`: 'individual' or 'organization'
- `organization_id`: Links employees to their organization
- `is_admin`: For platform administrators

#### **assignments**
- Created by organizations
- Matching weights customizable per assignment
- Status workflow: draft → published → closed

#### **matches**
- Generated by AI matching algorithm
- Includes detailed scoring breakdown
- Status: suggested → accepted/declined

#### **messages**
- Linked to matches
- Real-time via Supabase subscriptions
- Read receipts supported

#### **verification_requests**
- One-time secure tokens
- Email-based referee verification
- Expiration handling

---

## 🎯 Ready to Test!

After running the migration:
1. ✅ Refresh your app at http://localhost:3000
2. ✅ Sign up with a test account
3. ✅ Verify profile appears in Supabase Table Editor
4. ✅ Start testing features!

---

**Need help?** Check the error logs in your terminal and Supabase dashboard.
